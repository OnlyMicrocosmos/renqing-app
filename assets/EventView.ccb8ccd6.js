import{_ as S,r,e as a,f as u,h as t,F as M,E as N,G as D,t as i,B as $,u as L,m as U,o as A,c as F,q as T,i as x,C,j as b,v as V,y as h,H as j,A as I}from"./index.dca31d16.js";import{useContactStore as B}from"./contact.store.3ccc7ae8.js";const q={class:"event-list"},z={class:"table"},G={class:"event-description"},H={key:0,class:"event-notes"},R={class:"time-ago"},J={class:"actions"},K=["onClick"],O=["onClick"],P=["onClick"],Q={key:0,class:"modal"},W={class:"modal-content"},X={__name:"EventList",props:{events:{type:Array,default:()=>[]}},emits:["edit","delete"],setup(w,{emit:d}){const c=d,g=B(),v=s=>{const e=g.contacts.find(n=>n.id===s);return e?e.name:"\u65E0"},m=s=>{const e=new Date,n=new Date(s),o=e-n,f=Math.floor(o/(1e3*60*60*24));return f===0?"\u4ECA\u5929":f===1?"\u6628\u5929":f<7?`${f}\u5929\u524D`:`${f}\u5929\u524D`},y=s=>{c("edit",s)},p=async s=>{confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u4E8B\u4EF6\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002")&&await c("delete",s)},l=r(!1),_=r(null),E=s=>{_.value=s,l.value=!0},k=()=>{l.value=!1};return(s,e)=>(a(),u("div",q,[t("table",z,[e[3]||(e[3]=t("thead",null,[t("tr",null,[t("th",null,"\u4E8B\u4EF6\u63CF\u8FF0"),t("th",null,"\u8054\u7CFB\u4EBA"),t("th",null,"\u91D1\u989D"),t("th",null,"\u65E5\u671F"),t("th",null,"\u64CD\u4F5C")])],-1)),t("tbody",null,[(a(!0),u(M,null,N(w.events,n=>(a(),u("tr",{key:n.id},[t("td",null,[t("div",{class:D(["event-type-badge",n.type==="given"?"given":"received"])},i(n.type==="given"?"\u9001\u793C":"\u6536\u793C"),3),t("div",G,i(n.description),1),n.notes?(a(),u("div",H,i(n.notes),1)):$("",!0)]),t("td",null,[t("span",null,i(v(n.contactId)),1)]),t("td",null,[t("span",{class:D(n.type==="given"?"negative":"positive")},i(n.type==="given"?"-":"+")+"\xA5"+i(Math.abs(n.amount).toFixed(2)),3)]),t("td",null,[t("div",null,i(n.date),1),t("div",R,i(m(n.date)),1)]),t("td",J,[t("button",{class:"btn btn-sm btn-primary",onClick:o=>y(n),title:"\u7F16\u8F91\u4E8B\u4EF6"},e[0]||(e[0]=[t("i",{class:"icon-edit"},null,-1),t("span",{class:"btn-text"},"\u7F16\u8F91",-1)]),8,K),t("button",{class:"btn btn-sm btn-danger",onClick:o=>p(n.id),title:"\u5220\u9664\u4E8B\u4EF6"},e[1]||(e[1]=[t("i",{class:"icon-delete"},null,-1),t("span",{class:"btn-text"},"\u5220\u9664",-1)]),8,O),t("button",{class:"btn btn-sm btn-info",onClick:o=>E(n),title:"\u67E5\u770B\u5907\u6CE8"},e[2]||(e[2]=[t("i",{class:"icon-note"},null,-1),t("span",{class:"btn-text"},"\u5907\u6CE8",-1)]),8,P)])]))),128))])]),l.value?(a(),u("div",Q,[t("div",W,[e[4]||(e[4]=t("h3",null,"\u5907\u6CE8",-1)),t("p",null,i(_.value.notes),1),t("button",{class:"btn btn-secondary",onClick:k},"\u5173\u95ED")])])):$("",!0)]))}};var Y=S(X,[["__scopeId","data-v-40892368"],["__file","EventList.vue"]]);const Z={class:"event-view"},tt={class:"page-header flex-between"},et={class:"filters"},st={class:"filter-group"},nt={class:"filter-group"},lt=["value"],ot={class:"filter-group"},at={class:"date-range"},it={key:0,class:"loading"},ut={key:1,class:"error"},dt={key:2,class:"empty-state"},rt={__name:"EventView",setup(w){const d=L(),c=B(),g=U(),v=r([]),m=r([]),y=r(!0),p=r(null),l=r({type:"",contactId:"",startDate:"",endDate:""});A(async()=>{try{await c.loadContacts(),m.value=c.contacts,await d.loadEvents(),v.value=d.events||[]}catch(s){p.value=s.message||"\u52A0\u8F7D\u6570\u636E\u5931\u8D25"}finally{y.value=!1}});const _=F(()=>v.value.filter(s=>!(!s||!s.type||l.value.type&&s.type!==l.value.type||l.value.contactId&&s.contactId!=l.value.contactId||l.value.startDate&&s.date<l.value.startDate||l.value.endDate&&s.date>l.value.endDate))),E=s=>{typeof d.selectEvent=="function"?(console.log("selectEvent method exists, calling it with:",s),d.selectEvent(s)):console.error("eventStore.selectEvent is not a function"),g.push(`/events/edit/${s.id}`)},k=async s=>{confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u4E8B\u4EF6\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002")&&await d.deleteEvent(s)&&(v.value=d.events)};return(s,e)=>{const n=T("router-link");return a(),u("div",Z,[t("div",tt,[e[5]||(e[5]=t("div",null,[t("h1",null,"\u4E8B\u4EF6\u7BA1\u7406"),t("p",null,"\u8BB0\u5F55\u548C\u7BA1\u7406\u60A8\u7684\u4EBA\u60C5\u5F80\u6765\u4E8B\u4EF6")],-1)),x(n,{to:"/events/add",class:"btn"},{default:C(()=>e[4]||(e[4]=[t("i",{class:"icon-plus"},null,-1),I(" \u6DFB\u52A0\u4E8B\u4EF6 ",-1)])),_:1,__:[4]})]),t("div",et,[t("div",st,[e[7]||(e[7]=t("label",null,"\u4E8B\u4EF6\u7C7B\u578B",-1)),b(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.type=o)},e[6]||(e[6]=[t("option",{value:""},"\u5168\u90E8",-1),t("option",{value:"given"},"\u9001\u793C",-1),t("option",{value:"received"},"\u6536\u793C",-1)]),512),[[V,l.value.type]])]),t("div",nt,[e[9]||(e[9]=t("label",null,"\u8054\u7CFB\u4EBA",-1)),b(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.contactId=o)},[e[8]||(e[8]=t("option",{value:""},"\u5168\u90E8\u8054\u7CFB\u4EBA",-1)),(a(!0),u(M,null,N(m.value,o=>(a(),u("option",{key:o.id,value:o.id},i(o.name),9,lt))),128))],512),[[V,l.value.contactId]])]),t("div",ot,[e[11]||(e[11]=t("label",null,"\u65E5\u671F\u8303\u56F4",-1)),t("div",at,[b(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=o=>l.value.startDate=o)},null,512),[[h,l.value.startDate]]),e[10]||(e[10]=t("span",null,"\u81F3",-1)),b(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=o=>l.value.endDate=o)},null,512),[[h,l.value.endDate]])])])]),y.value?(a(),u("div",it,"\u52A0\u8F7D\u4E2D...")):p.value?(a(),u("div",ut,i(p.value),1)):_.value.length===0?(a(),u("div",dt,[e[13]||(e[13]=t("i",{class:"icon-empty"},null,-1)),e[14]||(e[14]=t("p",null,"\u6CA1\u6709\u627E\u5230\u5339\u914D\u7684\u4E8B\u4EF6",-1)),x(n,{to:"/events/add",class:"btn"},{default:C(()=>e[12]||(e[12]=[I("\u6DFB\u52A0\u7B2C\u4E00\u4E2A\u4E8B\u4EF6",-1)])),_:1,__:[12]})])):(a(),j(Y,{key:3,events:_.value,onEdit:E,onDelete:k},null,8,["events"]))])}}};var pt=S(rt,[["__scopeId","data-v-10c61760"],["__file","EventView.vue"]]);export{pt as default};
