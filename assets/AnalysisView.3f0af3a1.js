import{_ as x,u as E,r as y,c as o,w as S,o as B,e as f,f as g,h as e,j as h,v as w,i as D,t as u,L as m,G as Y,F as U,E as A}from"./index.45b4ffe3.js";import{B as M,T}from"./TimelineChart.cba4cea6.js";const k={format(n,l={}){const{currency:r="CNY",locale:i="zh-CN",precision:v=2}=l,d=parseFloat(n);return isNaN(d)?"\xA50.00":new Intl.NumberFormat(i,{style:"currency",currency:r,minimumFractionDigits:v,maximumFractionDigits:v}).format(d)},parse(n){const l=n.replace(/[^\d.-]/g,"");return parseFloat(l)||0},rmb(n){return this.format(n,{currency:"CNY"})},usd(n){return this.format(n,{currency:"USD",locale:"en-US"})},balance(n,l){const r=n-l;return this.format(r,{currency:"CNY",signDisplay:r>=0?"exceptZero":"always"})}},_=(n,l)=>k.format(n,l);const R={class:"analysis-view"},j={class:"card mt-3"},z={class:"card-header flex-between"},G={class:"time-filter"},I={class:"card mt-3"},L={class:"card-header flex-between"},q={class:"time-filter"},O={class:"grid-2 mt-3"},Z={class:"card"},H={class:"stats-grid"},J={class:"stat-item"},K={class:"stat-value negative"},P={class:"stat-item"},Q={class:"stat-value positive"},W={class:"stat-item"},X={class:"stat-item"},$={class:"stat-value"},ee={class:"card"},te={class:"relation-stats"},se={class:"relation-label"},ae={class:"relation-value"},le={class:"relation-amount"},ne={__name:"AnalysisView",setup(n){const l=E(),r=y("all"),i=y("30"),v=o(()=>l.events.filter(a=>a.type==="received").reduce((a,t)=>a+(t.amount||0),0)),d=o(()=>l.events.filter(a=>a.type==="given").reduce((a,t)=>a+(t.amount||0),0)),b=o(()=>({received:v.value,given:d.value})),p=o(()=>v.value-d.value),F=o(()=>p.value>0?"positive":p.value<0?"negative":""),V=o(()=>l.events.length),C=o(()=>{const a={};return l.events.forEach(t=>{var c;const s=((c=t.contact)==null?void 0:c.relation)||"\u672A\u77E5";a[s]||(a[s]={label:s,count:0,amount:0}),a[s].count++,a[s].amount+=t.amount||0}),Object.values(a)}),N=o(()=>{let a=[...l.events];if(i.value!=="all"){const t=new Date;let s;i.value==="30"?s=new Date(t.getFullYear(),t.getMonth(),t.getDate()-30):i.value==="90"?s=new Date(t.getFullYear(),t.getMonth(),t.getDate()-90):i.value==="year"&&(s=new Date(new Date().getFullYear(),0,1)),s&&(a=a.filter(c=>new Date(c.date)>=s))}return a.sort((t,s)=>new Date(s.date)-new Date(t.date))});return S(()=>l.events,()=>{console.log("Events updated, recalculating stats...")},{deep:!0}),B(()=>{l.loadEvents()}),(a,t)=>(f(),g("div",R,[t[12]||(t[12]=e("div",{class:"page-header"},[e("h1",null,"\u6570\u636E\u5206\u6790"),e("p",null,"\u6DF1\u5165\u4E86\u89E3\u60A8\u7684\u4EBA\u60C5\u5F80\u6765\u60C5\u51B5")],-1)),e("div",j,[e("div",z,[t[3]||(t[3]=e("h3",null,"\u4EBA\u60C5\u6536\u652F\u5E73\u8861",-1)),e("div",G,[h(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),class:"time-select"},t[2]||(t[2]=[e("option",{value:"all"},"\u5168\u90E8\u65F6\u95F4",-1),e("option",{value:"year"},"\u4ECA\u5E74",-1),e("option",{value:"quarter"},"\u672C\u5B63\u5EA6",-1),e("option",{value:"month"},"\u672C\u6708",-1)]),512),[[w,r.value]])])]),D(M,{data:b.value},null,8,["data"])]),e("div",I,[e("div",L,[t[5]||(t[5]=e("h3",null,"\u4EBA\u60C5\u4E8B\u4EF6\u65F6\u95F4\u7EBF",-1)),e("div",q,[h(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>i.value=s),class:"time-select"},t[4]||(t[4]=[e("option",{value:"30"},"\u6700\u8FD130\u5929",-1),e("option",{value:"90"},"\u6700\u8FD190\u5929",-1),e("option",{value:"year"},"\u4ECA\u5E74",-1),e("option",{value:"all"},"\u5168\u90E8\u65F6\u95F4",-1)]),512),[[w,i.value]])])]),D(T,{events:N.value},null,8,["events"])]),e("div",O,[e("div",Z,[t[10]||(t[10]=e("div",{class:"card-header"},[e("h3",null,"\u6309\u7C7B\u578B\u7EDF\u8BA1")],-1)),e("div",H,[e("div",J,[t[6]||(t[6]=e("div",{class:"stat-label"},"\u9001\u793C\u603B\u989D",-1)),e("div",K,u(m(_)(d.value)),1)]),e("div",P,[t[7]||(t[7]=e("div",{class:"stat-label"},"\u6536\u793C\u603B\u989D",-1)),e("div",Q,u(m(_)(v.value)),1)]),e("div",W,[t[8]||(t[8]=e("div",{class:"stat-label"},"\u51C0\u6536\u652F",-1)),e("div",{class:Y(["stat-value",F.value])},u(m(_)(p.value)),3)]),e("div",X,[t[9]||(t[9]=e("div",{class:"stat-label"},"\u4E8B\u4EF6\u603B\u6570",-1)),e("div",$,u(V.value),1)])])]),e("div",ee,[t[11]||(t[11]=e("div",{class:"card-header"},[e("h3",null,"\u6309\u5173\u7CFB\u7EDF\u8BA1")],-1)),e("div",te,[(f(!0),g(U,null,A(C.value,s=>(f(),g("div",{key:s.type,class:"relation-item"},[e("div",se,u(s.label),1),e("div",ae,u(s.count)+" \u9879",1),e("div",le,u(m(_)(s.amount)),1)]))),128))])])])]))}};var re=x(ne,[["__scopeId","data-v-61bac9ee"],["__file","AnalysisView.vue"]]);export{re as default};
